:- module(alloy2b_tests,[run_tests/0]).

:- use_module(alloy2b).
:- use_module(library(plunit)).

:- begin_tests(full_machine_translation).

test(cards,[]) :- 
    translate_model(alloy_model(facts([]),assertions([]),commands([]),functions([predicate('ThreeOfAKind_',[identifier('hand_',type(['Card_'],1),pos(20,3))],[field('hand_',setof(identifier('Card_',type(['Card_'],1),pos(5,1)),type(['Card_'],1),pos(26,3)),type(['Card_'],1),pos(20,3))],and([equal(card(join(identifier('hand_',type(['Card_'],1),pos(20,3)),identifier('suit_',type(['Card->this_''Suit_'],2),pos(11,1)),type(['Suit_'],1),pos(8,4)),type(['Int_'],1),pos(3,4)),integer(1,pos(14,4)),type([untyped],0),pos(13,4)), equal(card(identifier('hand_',type(['Card_'],1),pos(20,3)),type(['Int_'],1),pos(20,4)),integer(3,pos(26,4)),type([untyped],0),pos(25,4))],pos(16,4)),pos(1,3))]),signatures([signature('Card_',[field('suit_',oneof(identifier('Suit_',type(['Suit_'],1),pos(5,2)),type(['Suit_'],1),pos(16,1)),type(['Suit_'],1),pos(11,1))],[],[],pos(5,1)),signature('Suit_',[],[],[],pos(5,2))])),Translated) , ! , 
    Translated == machine(generated(none,abstract_machine(none,machine(none),machine_header(none,alloytranslation,[]),[definitions(none,[predicate_definition(none,'ThreeOfAKind_',[identifier(none,hand_)],conjunct(none,conjunct(none,equal(none,card(none,identifier(none,hand_)),integer(none,3)),equal(none,card(none,image(none,identifier(none,suit_),identifier(none,hand_))),integer(none,1))),member(none,identifier(none,hand_),identifier(none,'Card_'))))]),sets(none,[deferred_set(none,identifier(none,'Suit_')),deferred_set(none,identifier(none,'Card_'))]),properties(none,[conjunct(none,member(none,identifier(none,suit_),identifier(none,'Suit_')),equal(none,card(none,identifier(none,suit_)),integer(none,1)))])]))).

test(filesystem,[]) :- 
    translate_model(alloy_model(facts([fact(all(['d_', 'o_'],[field('d_',oneof(identifier('Dir_',type(['Dir_'],1),pos(5,5)),type(['Dir_'],1),pos(15,11)),type(['Dir_'],1),pos(12,11)), field('o_',oneof(join(identifier('d_',type(['Dir_'],1),pos(12,11)),identifier('contents_',type(['Dir->this_''FSObject_'],2),pos(28,5)),type(['FSObject_'],1),pos(24,11)),type(['FSObject_'],1),pos(23,11)),type(['FSObject_'],1),pos(20,11))],equal(join(identifier('o_',type(['FSObject_'],1),pos(20,11)),identifier('parent_',type(['FSObject->this_''Dir_'],2),pos(16,2)),type(['Dir_'],1),pos(37,11)),identifier('d_',type(['Dir_'],1),pos(12,11)),type([untyped],0),pos(45,11)),type([untyped],0),pos(8,11)),(1,11)),fact(equal(plus(identifier('File_',type(['File_'],1),pos(5,8)),identifier('Dir_',type(['Dir_'],1),pos(5,5)),type(['File_', 'Dir_'],1),pos(13,14)),identifier('FSObject_',type(['FSObject_'],1),pos(5,2)),type([untyped],0),pos(19,14)),(1,14)),fact(in(identifier('FSObject_',type(['FSObject_'],1),pos(5,2)),join(identifier('Root_',type(['Root_'],1),pos(9,17)),closure(identifier('contents_',type(['Dir->this_''FSObject_'],2),pos(28,5)),type(['univ->univ_'],2),pos(25,20)),type(['univ_'],1),pos(24,20)),type([untyped],0),pos(17,20)),(1,20))]),assertions([fact(no(['d_'],[field('d_',oneof(identifier('Dir_',type(['Dir_'],1),pos(5,5)),type(['Dir_'],1),pos(24,23)),type(['Dir_'],1),pos(21,23))],in(identifier('d_',type(['Dir_'],1),pos(21,23)),join(identifier('d_',type(['Dir_'],1),pos(21,23)),closure1(identifier('contents_',type(['Dir->this_''FSObject_'],2),pos(28,5)),type(['Dir->this_''FSObject_'],2),pos(37,23)),type(['FSObject_'],1),pos(36,23)),type([untyped],0),pos(32,23)),type([untyped],0),pos(18,23)),(1,23)),fact(one(['d_'],[field('d_',oneof(identifier('Dir_',type(['Dir_'],1),pos(5,5)),type(['Dir_'],1),pos(25,29)),type(['Dir_'],1),pos(22,29))],no(join(identifier('d_',type(['Dir_'],1),pos(22,29)),identifier('parent_',type(['FSObject->this_''Dir_'],2),pos(16,2)),type(['Dir_'],1),pos(35,29)),type([untyped],0),pos(31,29)),type([untyped],0),pos(18,29)),(1,29)),fact(all(['o_'],[field('o_',oneof(identifier('FSObject_',type(['FSObject_'],1),pos(5,2)),type(['FSObject_'],1),pos(29,35)),type(['FSObject_'],1),pos(26,35))],lone(['d_'],[field('d_',oneof(identifier('Dir_',type(['Dir_'],1),pos(5,5)),type(['Dir_'],1),pos(48,35)),type(['Dir_'],1),pos(45,35))],in(identifier('o_',type(['FSObject_'],1),pos(26,35)),join(identifier('d_',type(['Dir_'],1),pos(45,35)),identifier('contents_',type(['Dir->this_''FSObject_'],2),pos(28,5)),type(['FSObject_'],1),pos(60,35)),type([untyped],0),pos(56,35)),type([untyped],0),pos(40,35)),type([untyped],0),pos(22,35)),(1,35))]),commands([check(and([all(['d_', 'o_'],[field('d_',oneof(identifier('Dir_',type(['Dir_'],1),pos(5,5)),type(['Dir_'],1),pos(15,11)),type(['Dir_'],1),pos(12,11)), field('o_',oneof(join(identifier('d_',type(['Dir_'],1),pos(12,11)),identifier('contents_',type(['Dir->this_''FSObject_'],2),pos(28,5)),type(['FSObject_'],1),pos(24,11)),type(['FSObject_'],1),pos(23,11)),type(['FSObject_'],1),pos(20,11))],equal(join(identifier('o_',type(['FSObject_'],1),pos(20,11)),identifier('parent_',type(['FSObject->this_''Dir_'],2),pos(16,2)),type(['Dir_'],1),pos(37,11)),identifier('d_',type(['Dir_'],1),pos(12,11)),type([untyped],0),pos(45,11)),type([untyped],0),pos(8,11)), equal(plus(identifier('File_',type(['File_'],1),pos(5,8)),identifier('Dir_',type(['Dir_'],1),pos(5,5)),type(['File_', 'Dir_'],1),pos(13,14)),identifier('FSObject_',type(['FSObject_'],1),pos(5,2)),type([untyped],0),pos(19,14)), in(identifier('FSObject_',type(['FSObject_'],1),pos(5,2)),join(identifier('Root_',type(['Root_'],1),pos(9,17)),closure(identifier('contents_',type(['Dir->this_''FSObject_'],2),pos(28,5)),type(['univ->univ_'],2),pos(25,20)),type(['univ_'],1),pos(24,20)),type([untyped],0),pos(17,20)), not(no(['d_'],[field('d_',oneof(identifier('Dir_',type(['Dir_'],1),pos(5,5)),type(['Dir_'],1),pos(24,23)),type(['Dir_'],1),pos(21,23))],in(identifier('d_',type(['Dir_'],1),pos(21,23)),join(identifier('d_',type(['Dir_'],1),pos(21,23)),closure1(identifier('contents_',type(['Dir->this_''FSObject_'],2),pos(28,5)),type(['Dir->this_''FSObject_'],2),pos(37,23)),type(['FSObject_'],1),pos(36,23)),type([untyped],0),pos(32,23)),type([untyped],0),pos(18,23)),type([untyped],0),pos(1,23))],pos(1,11)),global_scope(5),exact_scopes([]),bitwidth(-1),pos(1,26)),check(and([all(['d_', 'o_'],[field('d_',oneof(identifier('Dir_',type(['Dir_'],1),pos(5,5)),type(['Dir_'],1),pos(15,11)),type(['Dir_'],1),pos(12,11)), field('o_',oneof(join(identifier('d_',type(['Dir_'],1),pos(12,11)),identifier('contents_',type(['Dir->this_''FSObject_'],2),pos(28,5)),type(['FSObject_'],1),pos(24,11)),type(['FSObject_'],1),pos(23,11)),type(['FSObject_'],1),pos(20,11))],equal(join(identifier('o_',type(['FSObject_'],1),pos(20,11)),identifier('parent_',type(['FSObject->this_''Dir_'],2),pos(16,2)),type(['Dir_'],1),pos(37,11)),identifier('d_',type(['Dir_'],1),pos(12,11)),type([untyped],0),pos(45,11)),type([untyped],0),pos(8,11)), equal(plus(identifier('File_',type(['File_'],1),pos(5,8)),identifier('Dir_',type(['Dir_'],1),pos(5,5)),type(['File_', 'Dir_'],1),pos(13,14)),identifier('FSObject_',type(['FSObject_'],1),pos(5,2)),type([untyped],0),pos(19,14)), in(identifier('FSObject_',type(['FSObject_'],1),pos(5,2)),join(identifier('Root_',type(['Root_'],1),pos(9,17)),closure(identifier('contents_',type(['Dir->this_''FSObject_'],2),pos(28,5)),type(['univ->univ_'],2),pos(25,20)),type(['univ_'],1),pos(24,20)),type([untyped],0),pos(17,20)), not(one(['d_'],[field('d_',oneof(identifier('Dir_',type(['Dir_'],1),pos(5,5)),type(['Dir_'],1),pos(25,29)),type(['Dir_'],1),pos(22,29))],no(join(identifier('d_',type(['Dir_'],1),pos(22,29)),identifier('parent_',type(['FSObject->this_''Dir_'],2),pos(16,2)),type(['Dir_'],1),pos(35,29)),type([untyped],0),pos(31,29)),type([untyped],0),pos(18,29)),type([untyped],0),pos(1,29))],pos(1,11)),global_scope(5),exact_scopes([]),bitwidth(-1),pos(1,32)),check(and([all(['d_', 'o_'],[field('d_',oneof(identifier('Dir_',type(['Dir_'],1),pos(5,5)),type(['Dir_'],1),pos(15,11)),type(['Dir_'],1),pos(12,11)), field('o_',oneof(join(identifier('d_',type(['Dir_'],1),pos(12,11)),identifier('contents_',type(['Dir->this_''FSObject_'],2),pos(28,5)),type(['FSObject_'],1),pos(24,11)),type(['FSObject_'],1),pos(23,11)),type(['FSObject_'],1),pos(20,11))],equal(join(identifier('o_',type(['FSObject_'],1),pos(20,11)),identifier('parent_',type(['FSObject->this_''Dir_'],2),pos(16,2)),type(['Dir_'],1),pos(37,11)),identifier('d_',type(['Dir_'],1),pos(12,11)),type([untyped],0),pos(45,11)),type([untyped],0),pos(8,11)), equal(plus(identifier('File_',type(['File_'],1),pos(5,8)),identifier('Dir_',type(['Dir_'],1),pos(5,5)),type(['File_', 'Dir_'],1),pos(13,14)),identifier('FSObject_',type(['FSObject_'],1),pos(5,2)),type([untyped],0),pos(19,14)), in(identifier('FSObject_',type(['FSObject_'],1),pos(5,2)),join(identifier('Root_',type(['Root_'],1),pos(9,17)),closure(identifier('contents_',type(['Dir->this_''FSObject_'],2),pos(28,5)),type(['univ->univ_'],2),pos(25,20)),type(['univ_'],1),pos(24,20)),type([untyped],0),pos(17,20)), not(all(['o_'],[field('o_',oneof(identifier('FSObject_',type(['FSObject_'],1),pos(5,2)),type(['FSObject_'],1),pos(29,35)),type(['FSObject_'],1),pos(26,35))],lone(['d_'],[field('d_',oneof(identifier('Dir_',type(['Dir_'],1),pos(5,5)),type(['Dir_'],1),pos(48,35)),type(['Dir_'],1),pos(45,35))],in(identifier('o_',type(['FSObject_'],1),pos(26,35)),join(identifier('d_',type(['Dir_'],1),pos(45,35)),identifier('contents_',type(['Dir->this_''FSObject_'],2),pos(28,5)),type(['FSObject_'],1),pos(60,35)),type([untyped],0),pos(56,35)),type([untyped],0),pos(40,35)),type([untyped],0),pos(22,35)),type([untyped],0),pos(1,35))],pos(1,11)),global_scope(5),exact_scopes([]),bitwidth(-1),pos(1,38))]),functions([]),signatures([signature('FSObject_',[field('parent_',loneof(identifier('Dir_',type(['Dir_'],1),pos(5,5)),type(['Dir_'],1),pos(24,2)),type(['Dir_'],1),pos(16,2))],[],[],pos(5,2)),signature('Dir_',[field('contents_',setof(identifier('FSObject_',type(['FSObject_'],1),pos(5,2)),type(['FSObject_'],1),pos(38,5)),type(['FSObject_'],1),pos(28,5))],[],[subsig('FSObject_')],pos(5,5)),signature('File_',[],[],[subsig('FSObject_')],pos(5,8)),signature('Root_',[],[no(join(identifier('Root_',type(['Root_'],1),pos(9,17)),identifier('parent_',type(['FSObject->this_''Dir_'],2),pos(16,2)),type(['Dir_'],1),pos(35,17)),type([untyped],0),pos(32,17))],[one, subsig('Dir_')],pos(9,17))])),Translated) , ! , 
    Translated == machine(generated(none,abstract_machine(none,machine(none),machine_header(none,alloytranslation,[]),[properties(none,[subset(none,identifier(none,'FSObject_'),image(none,closure(none,identifier(none,contents_)),identifier(none,'Root_'))),equal(none,union(none,identifier(none,'File_'),identifier(none,'Dir_')),identifier(none,'FSObject_')),forall(none,[identifier(none,d_),identifier(none,o_)],implication(none,conjunct(none,conjunct(none,member(none,identifier(none,o_),image(none,identifier(none,contents_),identifier(none,d_))),equal(none,card(none,identifier(none,o_)),integer(none,1))),conjunct(none,member(none,identifier(none,d_),identifier(none,'Dir_')),equal(none,card(none,identifier(none,d_)),integer(none,1)))),equal(none,image(none,identifier(none,parent_),identifier(none,o_)),identifier(none,d_)))),forall(none,[identifier(none,o_)],implication(none,conjunct(none,member(none,identifier(none,o_),identifier(none,'FSObject_')),equal(none,card(none,identifier(none,o_)),integer(none,1))),less_equal(none,card(none,comprehension_set(none,[identifier(none,d_)],conjunct(none,conjunct(none,member(none,identifier(none,d_),identifier(none,'Dir_')),equal(none,card(none,identifier(none,d_)),integer(none,1))),subset(none,identifier(none,o_),image(none,identifier(none,contents_),identifier(none,d_)))))),integer(none,1)))),equals(none,card(none,comprehension_set(none,[identifier(none,d_)],conjunct(none,conjunct(none,member(none,identifier(none,d_),identifier(none,'Dir_')),equal(none,card(none,identifier(none,d_)),integer(none,1))),no(none,image(none,identifier(none,parent_),identifier(none,d_)))))),integer(none,1)),not(exists(none,[identifier(none,d_)],conjunct(none,conjunct(none,member(none,identifier(none,d_),identifier(none,'Dir_')),equal(none,card(none,identifier(none,d_)),integer(none,1))),subset(none,identifier(none,d_),image(none,closure1(none,identifier(none,contents_)),identifier(none,d_)))))),no(none,image(none,identifier(none,parent_),identifier(none,'Root_'))),member(identifier(none,'Root_'),identifier(none,'Dir_')),member(identifier(none,'File_'),identifier(none,'FSObject_')),member(none,identifier(none,contents_),identifier(none,'FSObject_')),member(identifier(none,'Dir_'),identifier(none,'FSObject_')),conjunct(none,member(none,identifier(none,parent_),identifier(none,'Dir_')),less_equal(none,card(none,identifier(none,parent_)),integer(none,1)))]),operations(none,[operation(none,identifier(none,empty),[],[],precondition(none,conjunct(none,conjunct(none,truth(none),b(truth,pred,[])),conjunct(none,not(none,forall(none,[identifier(none,o_)],implication(none,conjunct(none,member(none,identifier(none,o_),identifier(none,'FSObject_')),equal(none,card(none,identifier(none,o_)),integer(none,1))),less_equal(none,card(none,comprehension_set(none,[identifier(none,d_)],conjunct(none,conjunct(none,member(none,identifier(none,d_),identifier(none,'Dir_')),equal(none,card(none,identifier(none,d_)),integer(none,1))),subset(none,identifier(none,o_),image(none,identifier(none,contents_),identifier(none,d_)))))),integer(none,1))))),conjunct(none,subset(none,identifier(none,'FSObject_'),image(none,closure(none,identifier(none,contents_)),identifier(none,'Root_'))),conjunct(none,equal(none,union(none,identifier(none,'File_'),identifier(none,'Dir_')),identifier(none,'FSObject_')),forall(none,[identifier(none,d_),identifier(none,o_)],implication(none,conjunct(none,conjunct(none,member(none,identifier(none,o_),image(none,identifier(none,contents_),identifier(none,d_))),equal(none,card(none,identifier(none,o_)),integer(none,1))),conjunct(none,member(none,identifier(none,d_),identifier(none,'Dir_')),equal(none,card(none,identifier(none,d_)),integer(none,1)))),equal(none,image(none,identifier(none,parent_),identifier(none,o_)),identifier(none,d_)))))))),skip(none))),operation(none,identifier(none,empty),[],[],precondition(none,conjunct(none,conjunct(none,truth(none),b(truth,pred,[])),conjunct(none,not(none,equals(none,card(none,comprehension_set(none,[identifier(none,d_)],conjunct(none,conjunct(none,member(none,identifier(none,d_),identifier(none,'Dir_')),equal(none,card(none,identifier(none,d_)),integer(none,1))),no(none,image(none,identifier(none,parent_),identifier(none,d_)))))),integer(none,1))),conjunct(none,subset(none,identifier(none,'FSObject_'),image(none,closure(none,identifier(none,contents_)),identifier(none,'Root_'))),conjunct(none,equal(none,union(none,identifier(none,'File_'),identifier(none,'Dir_')),identifier(none,'FSObject_')),forall(none,[identifier(none,d_),identifier(none,o_)],implication(none,conjunct(none,conjunct(none,member(none,identifier(none,o_),image(none,identifier(none,contents_),identifier(none,d_))),equal(none,card(none,identifier(none,o_)),integer(none,1))),conjunct(none,member(none,identifier(none,d_),identifier(none,'Dir_')),equal(none,card(none,identifier(none,d_)),integer(none,1)))),equal(none,image(none,identifier(none,parent_),identifier(none,o_)),identifier(none,d_)))))))),skip(none))),operation(none,identifier(none,empty),[],[],precondition(none,conjunct(none,conjunct(none,truth(none),b(truth,pred,[])),conjunct(none,not(none,not(exists(none,[identifier(none,d_)],conjunct(none,conjunct(none,member(none,identifier(none,d_),identifier(none,'Dir_')),equal(none,card(none,identifier(none,d_)),integer(none,1))),subset(none,identifier(none,d_),image(none,closure1(none,identifier(none,contents_)),identifier(none,d_))))))),conjunct(none,subset(none,identifier(none,'FSObject_'),image(none,closure(none,identifier(none,contents_)),identifier(none,'Root_'))),conjunct(none,equal(none,union(none,identifier(none,'File_'),identifier(none,'Dir_')),identifier(none,'FSObject_')),forall(none,[identifier(none,d_),identifier(none,o_)],implication(none,conjunct(none,conjunct(none,member(none,identifier(none,o_),image(none,identifier(none,contents_),identifier(none,d_))),equal(none,card(none,identifier(none,o_)),integer(none,1))),conjunct(none,member(none,identifier(none,d_),identifier(none,'Dir_')),equal(none,card(none,identifier(none,d_)),integer(none,1)))),equal(none,image(none,identifier(none,parent_),identifier(none,o_)),identifier(none,d_)))))))),skip(none)))]),constants(none,[identifier(none,'Root_'),identifier(none,'File_'),identifier(none,'Dir_')]),sets(none,[deferred_set(none,identifier(none,'FSObject_'))])]))).

test(river_crossing,[]) :- 
    translate_model(alloy_model(facts([fact(equal(identifier('eats_',type(['Object->this_''Object_'],2),pos(23,5)),plus(cartesian(identifier('Fox_',type(['Fox_'],1),pos(17,6)),identifier('Chicken_',type(['Chicken_'],1),pos(22,6)),type(['Fox->this_''Chicken_'],2),pos(18,9)),cartesian(identifier('Chicken_',type(['Chicken_'],1),pos(22,6)),identifier('Grain_',type(['Grain_'],1),pos(31,6)),type(['Chicken->this_''Grain_'],2),pos(37,9)),type(['Fox->this_''Chicken_', 'Chicken->this_''Grain_'],2),pos(28,9)),type([untyped],0),pos(13,9)),(1,9)),fact(and([equal(join(fun_call('ordering_''first_',[],type(['State_'],1),pos(8,15)),identifier('near_',type(['State->this_''Object_'],2),pos(13,12)),type(['Object_'],1),pos(13,15)),identifier('Object_',type(['Object_'],1),pos(14,5)),type([untyped],0),pos(19,15)), no(join(fun_call('ordering_''first_',[],type(['State_'],1),pos(34,15)),identifier('far_',type(['State->this_''Object_'],2),pos(13,12)),type(['Object_'],1),pos(39,15)),type([untyped],0),pos(31,15))],pos(28,15)),(1,15)),fact(all(['s_', 's__'],[field('s_',oneof(identifier('State_',type(['State_'],1),pos(5,12)),type(['State_'],1),pos(10,27)),type(['State_'],1),pos(7,27)), field('s__',oneof(join(identifier('s_',type(['State_'],1),pos(7,27)),fun_call('ordering_''next_',[],type(['State->this_''State_'],2),pos(23,27)),type(['State_'],1),pos(22,27)),type(['State_'],1),pos(21,27)),type(['State_'],1),pos(17,27))],if_then_else(in(identifier('Farmer_',type(['Farmer_'],1),pos(9,6)),join(identifier('s_',type(['State_'],1),pos(7,27)),identifier('near_',type(['State->this_''Object_'],2),pos(13,12)),type(['Object_'],1),pos(16,28)),type([untyped],0),pos(12,28)),pred_call('crossRiver_',[join(identifier('s_',type(['State_'],1),pos(7,27)),identifier('near_',type(['State->this_''Object_'],2),pos(13,12)),type(['Object_'],1),pos(20,29)), join(identifier('s__',type(['State_'],1),pos(17,27)),identifier('near_',type(['State->this_''Object_'],2),pos(13,12)),type(['Object_'],1),pos(29,29)), join(identifier('s_',type(['State_'],1),pos(7,27)),identifier('far_',type(['State->this_''Object_'],2),pos(13,12)),type(['Object_'],1),pos(37,29)), join(identifier('s__',type(['State_'],1),pos(17,27)),identifier('far_',type(['State->this_''Object_'],2),pos(13,12)),type(['Object_'],1),pos(45,29))],type([untyped],0),pos(7,29)),pred_call('crossRiver_',[join(identifier('s_',type(['State_'],1),pos(7,27)),identifier('far_',type(['State->this_''Object_'],2),pos(13,12)),type(['Object_'],1),pos(20,31)), join(identifier('s__',type(['State_'],1),pos(17,27)),identifier('far_',type(['State->this_''Object_'],2),pos(13,12)),type(['Object_'],1),pos(28,31)), join(identifier('s_',type(['State_'],1),pos(7,27)),identifier('near_',type(['State->this_''Object_'],2),pos(13,12)),type(['Object_'],1),pos(35,31)), join(identifier('s__',type(['State_'],1),pos(17,27)),identifier('near_',type(['State->this_''Object_'],2),pos(13,12)),type(['Object_'],1),pos(44,31))],type([untyped],0),pos(7,31)),type([untyped],0),pos(22,28)),type([untyped],0),pos(3,27)),(1,26))]),assertions([]),commands([run(and([equal(identifier('eats_',type(['Object->this_''Object_'],2),pos(23,5)),plus(cartesian(identifier('Fox_',type(['Fox_'],1),pos(17,6)),identifier('Chicken_',type(['Chicken_'],1),pos(22,6)),type(['Fox->this_''Chicken_'],2),pos(18,9)),cartesian(identifier('Chicken_',type(['Chicken_'],1),pos(22,6)),identifier('Grain_',type(['Grain_'],1),pos(31,6)),type(['Chicken->this_''Grain_'],2),pos(37,9)),type(['Fox->this_''Chicken_', 'Chicken->this_''Grain_'],2),pos(28,9)),type([untyped],0),pos(13,9)), equal(join(fun_call('ordering_''first_',[],type(['State_'],1),pos(8,15)),identifier('near_',type(['State->this_''Object_'],2),pos(13,12)),type(['Object_'],1),pos(13,15)),identifier('Object_',type(['Object_'],1),pos(14,5)),type([untyped],0),pos(19,15)), no(join(fun_call('ordering_''first_',[],type(['State_'],1),pos(34,15)),identifier('far_',type(['State->this_''Object_'],2),pos(13,12)),type(['Object_'],1),pos(39,15)),type([untyped],0),pos(31,15)), all(['s_', 's__'],[field('s_',oneof(identifier('State_',type(['State_'],1),pos(5,12)),type(['State_'],1),pos(10,27)),type(['State_'],1),pos(7,27)), field('s__',oneof(join(identifier('s_',type(['State_'],1),pos(7,27)),fun_call('ordering_''next_',[],type(['State->this_''State_'],2),pos(23,27)),type(['State_'],1),pos(22,27)),type(['State_'],1),pos(21,27)),type(['State_'],1),pos(17,27))],if_then_else(in(identifier('Farmer_',type(['Farmer_'],1),pos(9,6)),join(identifier('s_',type(['State_'],1),pos(7,27)),identifier('near_',type(['State->this_''Object_'],2),pos(13,12)),type(['Object_'],1),pos(16,28)),type([untyped],0),pos(12,28)),pred_call('crossRiver_',[join(identifier('s_',type(['State_'],1),pos(7,27)),identifier('near_',type(['State->this_''Object_'],2),pos(13,12)),type(['Object_'],1),pos(20,29)), join(identifier('s__',type(['State_'],1),pos(17,27)),identifier('near_',type(['State->this_''Object_'],2),pos(13,12)),type(['Object_'],1),pos(29,29)), join(identifier('s_',type(['State_'],1),pos(7,27)),identifier('far_',type(['State->this_''Object_'],2),pos(13,12)),type(['Object_'],1),pos(37,29)), join(identifier('s__',type(['State_'],1),pos(17,27)),identifier('far_',type(['State->this_''Object_'],2),pos(13,12)),type(['Object_'],1),pos(45,29))],type([untyped],0),pos(7,29)),pred_call('crossRiver_',[join(identifier('s_',type(['State_'],1),pos(7,27)),identifier('far_',type(['State->this_''Object_'],2),pos(13,12)),type(['Object_'],1),pos(20,31)), join(identifier('s__',type(['State_'],1),pos(17,27)),identifier('far_',type(['State->this_''Object_'],2),pos(13,12)),type(['Object_'],1),pos(28,31)), join(identifier('s_',type(['State_'],1),pos(7,27)),identifier('near_',type(['State->this_''Object_'],2),pos(13,12)),type(['Object_'],1),pos(35,31)), join(identifier('s__',type(['State_'],1),pos(17,27)),identifier('near_',type(['State->this_''Object_'],2),pos(13,12)),type(['Object_'],1),pos(44,31))],type([untyped],0),pos(7,31)),type([untyped],0),pos(22,28)),type([untyped],0),pos(3,27)), equal(join(fun_call('ordering_''last_',[],type(['State_'],1),pos(7,36)),identifier('far_',type(['State->this_''Object_'],2),pos(13,12)),type(['Object_'],1),pos(11,36)),identifier('Object_',type(['Object_'],1),pos(14,5)),type([untyped],0),pos(15,36))],pos(1,9)),global_scope(-1),exact_scopes([('State_',8)]),bitwidth(-1),pos(1,36))]),functions([predicate('crossRiver_',[identifier('from_',type(['Object_'],1),pos(18,18)), identifier('from__',type(['Object_'],1),pos(24,18)), identifier('to_',type(['Object_'],1),pos(31,18)), identifier('to__',type(['Object_'],1),pos(35,18))],[field('from_',setof(identifier('Object_',type(['Object_'],1),pos(14,5)),type(['Object_'],1),pos(40,18)),type(['Object_'],1),pos(18,18))],one(['x_'],[field('x_',oneof(identifier('from_',type(['Object_'],1),pos(18,18)),type(['Object_'],1),pos(10,19)),type(['Object_'],1),pos(7,19))],and([equal(identifier('from__',type(['Object_'],1),pos(24,18)),minus(minus(minus(identifier('from_',type(['Object_'],1),pos(18,18)),identifier('x_',type(['Object_'],1),pos(7,19)),type(['Object_'],1),pos(18,20)),identifier('Farmer_',type(['Farmer_'],1),pos(9,6)),type(['Object_'],1),pos(22,20)),join(identifier('from__',type(['Object_'],1),pos(24,18)),identifier('eats_',type(['Object->this_''Object_'],2),pos(23,5)),type(['Object_'],1),pos(38,20)),type(['Object_'],1),pos(31,20)),type([untyped],0),pos(11,20)), equal(identifier('to__',type(['Object_'],1),pos(35,18)),plus(plus(identifier('to_',type(['Object_'],1),pos(31,18)),identifier('x_',type(['Object_'],1),pos(7,19)),type(['Object_'],1),pos(14,21)),identifier('Farmer_',type(['Farmer_'],1),pos(9,6)),type(['Object_'],1),pos(18,21)),type([untyped],0),pos(9,21))],pos(1,1)),type([untyped],0),pos(3,19)),pos(1,18)),predicate('run$1_',[],[],equal(join(fun_call('ordering_''last_',[],type(['State_'],1),pos(7,36)),identifier('far_',type(['State->this_''Object_'],2),pos(13,12)),type(['Object_'],1),pos(11,36)),identifier('Object_',type(['Object_'],1),pos(14,5)),type([untyped],0),pos(15,36)),pos(1,36))]),signatures([signature('Object_',[field('eats_',setof(identifier('Object_',type(['Object_'],1),pos(14,5)),type(['Object_'],1),pos(29,5)),type(['Object_'],1),pos(23,5))],[],[abstract],pos(14,5)),signature('Farmer_',[],[],[one, subsig('Object_')],pos(9,6)),signature('Fox_',[],[],[one, subsig('Object_')],pos(17,6)),signature('Chicken_',[],[],[one, subsig('Object_')],pos(22,6)),signature('Grain_',[],[],[one, subsig('Object_')],pos(31,6)),signature('State_',[field('near_',setof(identifier('Object_',type(['Object_'],1),pos(14,5)),type(['Object_'],1),pos(24,12)),type(['Object_'],1),pos(13,12))],[],[ordered],pos(5,12))])),Translated) , ! , 
    Translated == machine(generated(none,abstract_machine(none,machine(none),machine_header(none,alloytranslation,[]),[properties(none,[forall(none,[identifier(none,s_),identifier(none,s__)],implication(none,conjunct(none,conjunct(none,member(none,identifier(none,s__),image(none,definition('ordering_\'next_',[],type(['State->this_\'State_'],2),pos(23,27)),identifier(none,s_))),equal(none,card(none,identifier(none,s__)),integer(none,1))),conjunct(none,member(none,identifier(none,s_),identifier(none,'State_')),equal(none,card(none,identifier(none,s_)),integer(none,1)))),if_then_else(none,subset(none,identifier(none,'Farmer_'),image(none,identifier(none,near_),identifier(none,s_))),definition(crossRiver_,[image(none,identifier(none,near_),identifier(none,s_)),image(none,identifier(none,near_),identifier(none,s__)),image(none,identifier(none,far_),identifier(none,s_)),image(none,identifier(none,far_),identifier(none,s__))],type([untyped],0),pos(7,29))))),conjunct(none,no(none,image(none,identifier(none,far_),definition('ordering_\'first_',[],type(['State_'],1),pos(34,15)))),equal(none,image(none,identifier(none,near_),definition('ordering_\'first_',[],type(['State_'],1),pos(8,15))),identifier(none,'Object_'))),equal(none,identifier(none,eats_),union(none,cartesian(none,identifier(none,'Fox_'),identifier(none,'Chicken_')),cartesian(none,identifier(none,'Chicken_'),identifier(none,'Grain_')))),member(none,identifier(none,near_),identifier(none,'Object_')),member(identifier(none,'Grain_'),identifier(none,'Object_')),member(identifier(none,'Chicken_'),identifier(none,'Object_')),member(identifier(none,'Fox_'),identifier(none,'Object_')),member(identifier(none,'Farmer_'),identifier(none,'Object_')),member(none,identifier(none,eats_),identifier(none,'Object_'))]),definitions(none,[predicate_definition(none,'run$1_',[],equal(none,image(none,identifier(none,far_),definition('ordering_\'last_',[],type(['State_'],1),pos(7,36))),identifier(none,'Object_'))),predicate_definition(none,crossRiver_,[identifier(none,from_),identifier(none,from__),identifier(none,to_),identifier(none,to__)],conjunct(none,equals(none,card(none,comprehension_set(none,[identifier(none,x_)],conjunct(none,conjunct(none,member(none,identifier(none,x_),identifier(none,from_)),equal(none,card(none,identifier(none,x_)),integer(none,1))),conjunct(none,equal(none,identifier(none,to__),union(none,union(none,identifier(none,to_),identifier(none,x_)),identifier(none,'Farmer_'))),equal(none,identifier(none,from__),set_subtraction(none,set_subtraction(none,set_subtraction(none,identifier(none,from_),identifier(none,x_)),identifier(none,'Farmer_')),image(none,identifier(none,eats_),identifier(none,from__)))))))),integer(none,1)),member(none,identifier(none,from_),identifier(none,'Object_'))))]),operations(none,[operation(none,identifier(none,empty),[],[],precondition(none,conjunct(none,conjunct(none,equal(none,card(none,identifier(none,'State_')),integer(none,8)),truth(none)),conjunct(none,equal(none,image(none,identifier(none,far_),definition('ordering_\'last_',[],type(['State_'],1),pos(7,36))),identifier(none,'Object_')),conjunct(none,forall(none,[identifier(none,s_),identifier(none,s__)],implication(none,conjunct(none,conjunct(none,member(none,identifier(none,s__),image(none,definition('ordering_\'next_',[],type(['State->this_\'State_'],2),pos(23,27)),identifier(none,s_))),equal(none,card(none,identifier(none,s__)),integer(none,1))),conjunct(none,member(none,identifier(none,s_),identifier(none,'State_')),equal(none,card(none,identifier(none,s_)),integer(none,1)))),if_then_else(none,subset(none,identifier(none,'Farmer_'),image(none,identifier(none,near_),identifier(none,s_))),definition(crossRiver_,[image(none,identifier(none,near_),identifier(none,s_)),image(none,identifier(none,near_),identifier(none,s__)),image(none,identifier(none,far_),identifier(none,s_)),image(none,identifier(none,far_),identifier(none,s__))],type([untyped],0),pos(7,29))))),conjunct(none,no(none,image(none,identifier(none,far_),definition('ordering_\'first_',[],type(['State_'],1),pos(34,15)))),conjunct(none,equal(none,image(none,identifier(none,near_),definition('ordering_\'first_',[],type(['State_'],1),pos(8,15))),identifier(none,'Object_')),equal(none,identifier(none,eats_),union(none,cartesian(none,identifier(none,'Fox_'),identifier(none,'Chicken_')),cartesian(none,identifier(none,'Chicken_'),identifier(none,'Grain_'))))))))),skip(none)))]),sets(none,[deferred_set(none,identifier(none,'State_')),deferred_set(none,identifier(none,'Object_'))]),constants(none,[identifier(none,'Grain_'),identifier(none,'Chicken_'),identifier(none,'Fox_'),identifier(none,'Farmer_')])]))).

test(crewalloc,[]) :- 
    translate_model(alloy_model(facts([fact(equal(identifier('male_',type(['Personell_'],1),pos(5,7)),plus(plus(identifier('tom_',type(['tom_'],1),pos(9,6)),identifier('david_',type(['david_'],1),pos(14,6)),type(['tom_', 'david_'],1),pos(13,13)),identifier('jeremy_',type(['jeremy_'],1),pos(21,6)),type(['tom_', 'david_', 'jeremy_'],1),pos(19,13)),type([untyped],0),pos(8,13)),(1,12)),fact(equal(identifier('speaks_',type(['Personell->this_''Language_'],2),pos(26,5)),plus(plus(plus(plus(plus(cartesian(identifier('tom_',type(['tom_'],1),pos(9,6)),identifier('german_',type(['german_'],1),pos(17,4)),type(['tom->this_''german_'],2),pos(14,16)),cartesian(identifier('david_',type(['david_'],1),pos(14,6)),identifier('french_',type(['french_'],1),pos(9,4)),type(['david->this_''french_'],2),pos(30,16)),type(['tom->this_''german_', 'david->this_''french_'],2),pos(23,16)),cartesian(identifier('jeremy_',type(['jeremy_'],1),pos(21,6)),identifier('german_',type(['german_'],1),pos(17,4)),type(['jeremy->this_''german_'],2),pos(47,16)),type(['tom->this_''german_', 'david->this_''french_', 'jeremy->this_''german_'],2),pos(39,16)),cartesian(identifier('carol_',type(['carol_'],1),pos(29,6)),identifier('spanish_',type(['spanish_'],1),pos(25,4)),type(['carol->this_''spanish_'],2),pos(63,16)),type(['tom->this_''german_', 'david->this_''french_', 'jeremy->this_''german_', 'carol->this_''spanish_'],2),pos(56,16)),cartesian(identifier('janet_',type(['janet_'],1),pos(36,6)),identifier('french_',type(['french_'],1),pos(9,4)),type(['janet->this_''french_'],2),pos(80,16)),type(['tom->this_''german_', 'david->this_''french_', 'jeremy->this_''german_', 'carol->this_''spanish_', 'janet->this_''french_'],2),pos(73,16)),cartesian(identifier('tracy_',type(['tracy_'],1),pos(43,6)),identifier('spanish_',type(['spanish_'],1),pos(25,4)),type(['tracy->this_''spanish_'],2),pos(96,16)),type(['tom->this_''german_', 'david->this_''french_', 'jeremy->this_''german_', 'carol->this_''spanish_', 'janet->this_''french_', 'tracy->this_''spanish_'],2),pos(89,16)),type([untyped],0),pos(10,16)),(1,15))]),assertions([]),commands([run(and([equal(identifier('male_',type(['Personell_'],1),pos(5,7)),plus(plus(identifier('tom_',type(['tom_'],1),pos(9,6)),identifier('david_',type(['david_'],1),pos(14,6)),type(['tom_', 'david_'],1),pos(13,13)),identifier('jeremy_',type(['jeremy_'],1),pos(21,6)),type(['tom_', 'david_', 'jeremy_'],1),pos(19,13)),type([untyped],0),pos(8,13)), equal(identifier('speaks_',type(['Personell->this_''Language_'],2),pos(26,5)),plus(plus(plus(plus(plus(cartesian(identifier('tom_',type(['tom_'],1),pos(9,6)),identifier('german_',type(['german_'],1),pos(17,4)),type(['tom->this_''german_'],2),pos(14,16)),cartesian(identifier('david_',type(['david_'],1),pos(14,6)),identifier('french_',type(['french_'],1),pos(9,4)),type(['david->this_''french_'],2),pos(30,16)),type(['tom->this_''german_', 'david->this_''french_'],2),pos(23,16)),cartesian(identifier('jeremy_',type(['jeremy_'],1),pos(21,6)),identifier('german_',type(['german_'],1),pos(17,4)),type(['jeremy->this_''german_'],2),pos(47,16)),type(['tom->this_''german_', 'david->this_''french_', 'jeremy->this_''german_'],2),pos(39,16)),cartesian(identifier('carol_',type(['carol_'],1),pos(29,6)),identifier('spanish_',type(['spanish_'],1),pos(25,4)),type(['carol->this_''spanish_'],2),pos(63,16)),type(['tom->this_''german_', 'david->this_''french_', 'jeremy->this_''german_', 'carol->this_''spanish_'],2),pos(56,16)),cartesian(identifier('janet_',type(['janet_'],1),pos(36,6)),identifier('french_',type(['french_'],1),pos(9,4)),type(['janet->this_''french_'],2),pos(80,16)),type(['tom->this_''german_', 'david->this_''french_', 'jeremy->this_''german_', 'carol->this_''spanish_', 'janet->this_''french_'],2),pos(73,16)),cartesian(identifier('tracy_',type(['tracy_'],1),pos(43,6)),identifier('spanish_',type(['spanish_'],1),pos(25,4)),type(['tracy->this_''spanish_'],2),pos(96,16)),type(['tom->this_''german_', 'david->this_''french_', 'jeremy->this_''german_', 'carol->this_''spanish_', 'janet->this_''french_', 'tracy->this_''spanish_'],2),pos(89,16)),type([untyped],0),pos(10,16)), pred_call('allLanguages_',[],type([untyped],0),pos(3,31)), pred_call('allSexes_',[],type([untyped],0),pos(20,31)), pred_call('scheduleOk_',[],type([untyped],0),pos(33,31)), pred_call('everybodyInSchedule_',[],type([untyped],0),pos(48,31))],pos(1,12)),global_scope(-1),exact_scopes([]),bitwidth(-1),pos(1,34))]),functions([predicate('allLanguages_',[],[],all(['f_'],[field('f_',oneof(identifier('Flight_',type(['Flight_'],1),pos(5,8)),type(['Flight_'],1),pos(9,19)),type(['Flight_'],1),pos(7,19))],equal(join(join(identifier('f_',type(['Flight_'],1),pos(7,19)),identifier('assign_',type(['Flight->this_''Personell_'],2),pos(3,9)),type(['Personell_'],1),pos(19,19)),identifier('speaks_',type(['Personell->this_''Language_'],2),pos(26,5)),type(['Language_'],1),pos(26,19)),identifier('Language_',type(['Language_'],1),pos(14,3)),type([untyped],0),pos(34,19)),type([untyped],0),pos(3,19)),pos(1,18)),predicate('allSexes_',[],[],all(['f_'],[field('f_',oneof(identifier('Flight_',type(['Flight_'],1),pos(5,8)),type(['Flight_'],1),pos(9,22)),type(['Flight_'],1),pos(7,22))],and([some(minus(join(identifier('f_',type(['Flight_'],1),pos(7,22)),identifier('assign_',type(['Flight->this_''Personell_'],2),pos(3,9)),type(['Personell_'],1),pos(25,22)),identifier('male_',type(['Personell_'],1),pos(5,7)),type(['Personell_'],1),pos(32,22)),type([untyped],0),pos(18,22)), some(intersection(join(identifier('f_',type(['Flight_'],1),pos(7,22)),identifier('assign_',type(['Flight->this_''Personell_'],2),pos(3,9)),type(['Personell_'],1),pos(50,22)),identifier('male_',type(['Personell_'],1),pos(5,7)),type(['Personell_'],1),pos(58,22)),type([untyped],0),pos(43,22))],pos(39,22)),type([untyped],0),pos(3,22)),pos(1,21)),predicate('scheduleOk_',[],[],all(['p_', 'f_'],[field('p_',oneof(identifier('Personell_',type(['Personell_'],1),pos(14,5)),type(['Personell_'],1),pos(9,25)),type(['Personell_'],1),pos(7,25)), field('f_',oneof(identifier('Flight_',type(['Flight_'],1),pos(5,8)),type(['Flight_'],1),pos(24,25)),type(['Flight_'],1),pos(20,25))],implication(and([in(identifier('p_',type(['Personell_'],1),pos(7,25)),join(identifier('f_',type(['Flight_'],1),pos(20,25)),identifier('assign_',type(['Flight->this_''Personell_'],2),pos(3,9)),type(['Personell_'],1),pos(39,25)),type([untyped],0),pos(35,25)), in(identifier('p_',type(['Personell_'],1),pos(7,25)),join(join(identifier('f_',type(['Flight_'],1),pos(20,25)),fun_call('ordering_''next_',[],type(['Flight->this_''Flight_'],2),pos(56,25)),type(['Flight_'],1),pos(56,25)),identifier('assign_',type(['Flight->this_''Personell_'],2),pos(3,9)),type(['Personell_'],1),pos(63,25)),type([untyped],0),pos(53,25))],pos(47,25)),not(in(identifier('p_',type(['Personell_'],1),pos(7,25)),join(join(join(identifier('f_',type(['Flight_'],1),pos(20,25)),fun_call('ordering_''next_',[],type(['Flight->this_''Flight_'],2),pos(89,25)),type(['Flight_'],1),pos(89,25)),fun_call('ordering_''next_',[],type(['Flight->this_''Flight_'],2),pos(84,25)),type(['Flight_'],1),pos(84,25)),identifier('assign_',type(['Flight->this_''Personell_'],2),pos(3,9)),type(['Personell_'],1),pos(97,25)),type([untyped],0),pos(81,25)),type([untyped],0),pos(74,25)),type([untyped],0),pos(71,25)),type([untyped],0),pos(3,25)),pos(1,24)),predicate('everybodyInSchedule_',[],[],equal(join(identifier('univ_',type(['univ_'],1),pos(1,1)),identifier('assign_',type(['Flight->this_''Personell_'],2),pos(3,9)),type(['Personell_'],1),pos(7,28)),identifier('Personell_',type(['Personell_'],1),pos(14,5)),type([untyped],0),pos(15,28)),pos(1,27)),predicate('crewAlloc_',[],[],and([pred_call('allLanguages_',[],type([untyped],0),pos(3,31)), pred_call('allSexes_',[],type([untyped],0),pos(20,31)), pred_call('scheduleOk_',[],type([untyped],0),pos(33,31)), pred_call('everybodyInSchedule_',[],type([untyped],0),pos(48,31))],pos(44,31)),pos(1,30))]),signatures([signature('Language_',[],[],[abstract],pos(14,3)),signature('french_',[],[],[one, subsig('Language_')],pos(9,4)),signature('german_',[],[],[one, subsig('Language_')],pos(17,4)),signature('spanish_',[],[],[one, subsig('Language_')],pos(25,4)),signature('Personell_',[field('speaks_',setof(identifier('Language_',type(['Language_'],1),pos(14,3)),type(['Language_'],1),pos(35,5)),type(['Language_'],1),pos(26,5))],[],[abstract],pos(14,5)),signature('tom_',[],[],[one, subsig('Personell_')],pos(9,6)),signature('david_',[],[],[one, subsig('Personell_')],pos(14,6)),signature('jeremy_',[],[],[one, subsig('Personell_')],pos(21,6)),signature('carol_',[],[],[one, subsig('Personell_')],pos(29,6)),signature('janet_',[],[],[one, subsig('Personell_')],pos(36,6)),signature('tracy_',[],[],[one, subsig('Personell_')],pos(43,6)),signature('male_',[],[],[subset(['Personell_'])],pos(5,7)),signature('Flight_',[field('assign_',setof(identifier('Personell_',type(['Personell_'],1),pos(14,5)),type(['Personell_'],1),pos(12,9)),type(['Personell_'],1),pos(3,9))],[],[ordered],pos(5,8))])),Translated) , ! , 
    Translated == machine(generated(none,abstract_machine(none,machine(none),machine_header(none,alloytranslation,[]),[properties(none,[equal(none,identifier(none,speaks_),union(none,union(none,union(none,union(none,union(none,cartesian(none,identifier(none,tom_),identifier(none,german_)),cartesian(none,identifier(none,david_),identifier(none,french_))),cartesian(none,identifier(none,jeremy_),identifier(none,german_))),cartesian(none,identifier(none,carol_),identifier(none,spanish_))),cartesian(none,identifier(none,janet_),identifier(none,french_))),cartesian(none,identifier(none,tracy_),identifier(none,spanish_)))),equal(none,identifier(none,male_),union(none,union(none,identifier(none,tom_),identifier(none,david_)),identifier(none,jeremy_))),member(none,identifier(none,assign_),identifier(none,'Personell_')),member(none,identifier(none,male_),identifier(none,'Personell_')),member(identifier(none,tracy_),identifier(none,'Personell_')),member(identifier(none,janet_),identifier(none,'Personell_')),member(identifier(none,carol_),identifier(none,'Personell_')),member(identifier(none,jeremy_),identifier(none,'Personell_')),member(identifier(none,david_),identifier(none,'Personell_')),member(identifier(none,tom_),identifier(none,'Personell_')),member(none,identifier(none,speaks_),identifier(none,'Language_')),member(identifier(none,spanish_),identifier(none,'Language_')),member(identifier(none,german_),identifier(none,'Language_')),member(identifier(none,french_),identifier(none,'Language_'))]),definitions(none,[predicate_definition(none,crewAlloc_,[],conjunct(none,definition(everybodyInSchedule_,[],type([untyped],0),pos(48,31)),conjunct(none,definition(scheduleOk_,[],type([untyped],0),pos(33,31)),conjunct(none,definition(allSexes_,[],type([untyped],0),pos(20,31)),definition(allLanguages_,[],type([untyped],0),pos(3,31)))))),predicate_definition(none,everybodyInSchedule_,[],equal(none,ran(none,identifier(none,assign_)),identifier(none,'Personell_'))),predicate_definition(none,scheduleOk_,[],forall(none,[identifier(none,p_),identifier(none,f_)],implication(none,conjunct(none,conjunct(none,member(none,identifier(none,f_),identifier(none,'Flight_')),equal(none,card(none,identifier(none,f_)),integer(none,1))),conjunct(none,member(none,identifier(none,p_),identifier(none,'Personell_')),equal(none,card(none,identifier(none,p_)),integer(none,1)))),implication(none,conjunct(none,subset(none,identifier(none,p_),image(none,identifier(none,assign_),image(none,definition('ordering_\'next_',[],type(['Flight->this_\'Flight_'],2),pos(56,25)),identifier(none,f_)))),subset(none,identifier(none,p_),image(none,identifier(none,assign_),identifier(none,f_)))),not(none,subset(none,identifier(none,p_),image(none,identifier(none,assign_),image(none,definition('ordering_\'next_',[],type(['Flight->this_\'Flight_'],2),pos(84,25)),image(none,definition('ordering_\'next_',[],type(['Flight->this_\'Flight_'],2),pos(89,25)),identifier(none,f_)))))))))),predicate_definition(none,allSexes_,[],forall(none,[identifier(none,f_)],implication(none,conjunct(none,member(none,identifier(none,f_),identifier(none,'Flight_')),equal(none,card(none,identifier(none,f_)),integer(none,1))),conjunct(none,some(none,intersection(none,image(none,identifier(none,assign_),identifier(none,f_)),identifier(none,male_))),some(none,set_subtraction(none,image(none,identifier(none,assign_),identifier(none,f_)),identifier(none,male_))))))),predicate_definition(none,allLanguages_,[],forall(none,[identifier(none,f_)],implication(none,conjunct(none,member(none,identifier(none,f_),identifier(none,'Flight_')),equal(none,card(none,identifier(none,f_)),integer(none,1))),equal(none,image(none,identifier(none,speaks_),image(none,identifier(none,assign_),identifier(none,f_))),identifier(none,'Language_')))))]),operations(none,[operation(none,identifier(none,empty),[],[],precondition(none,conjunct(none,conjunct(none,truth(none),truth(none)),conjunct(none,definition(everybodyInSchedule_,[],type([untyped],0),pos(48,31)),conjunct(none,definition(scheduleOk_,[],type([untyped],0),pos(33,31)),conjunct(none,definition(allSexes_,[],type([untyped],0),pos(20,31)),conjunct(none,definition(allLanguages_,[],type([untyped],0),pos(3,31)),conjunct(none,equal(none,identifier(none,speaks_),union(none,union(none,union(none,union(none,union(none,cartesian(none,identifier(none,tom_),identifier(none,german_)),cartesian(none,identifier(none,david_),identifier(none,french_))),cartesian(none,identifier(none,jeremy_),identifier(none,german_))),cartesian(none,identifier(none,carol_),identifier(none,spanish_))),cartesian(none,identifier(none,janet_),identifier(none,french_))),cartesian(none,identifier(none,tracy_),identifier(none,spanish_)))),equal(none,identifier(none,male_),union(none,union(none,identifier(none,tom_),identifier(none,david_)),identifier(none,jeremy_))))))))),skip(none)))]),sets(none,[deferred_set(none,identifier(none,'Flight_')),deferred_set(none,identifier(none,'Personell_')),deferred_set(none,identifier(none,'Language_'))]),constants(none,[identifier(none,male_),identifier(none,tracy_),identifier(none,janet_),identifier(none,carol_),identifier(none,jeremy_),identifier(none,david_),identifier(none,tom_),identifier(none,spanish_),identifier(none,german_),identifier(none,french_)])]))).

:- end_tests(full_machine_translation).

:- begin_tests(single_expr_translation).

% fields
test(field_set_of,[]) :- 
    alloy2b:translate_field_aux(field('hand_',setof(identifier('Card_',type(['Card_'],1),pos(5,1)),type(['Card_'],1),pos(26,3)),type(['Card_'],1),pos(20,3)),Translated) , ! , 
    Translated == member(none,identifier(none,hand_),identifier(none,'Card_')).

test(field_one_of,[]) :- 
    alloy2b:translate_field_aux(field('d_',oneof(identifier('Dir_',type(['Dir_'],1),pos(5,5)),type(['Dir_'],1),pos(15,11)),type(['Dir_'],1),pos(12,11)),Translated) , ! , 
    Translated == conjunct(none,member(none,identifier(none,d_),identifier(none,'Dir_')),equal(none,card(none,identifier(none,d_)),integer(none,1))).

test(field_some_of,[]) :- 
    alloy2b:translate_field_aux(field('parent_',someof(identifier('Dir_',type(['Dir_'],1),pos(5,5)),type(['Dir_'],1),pos(24,2)),type(['Dir_'],1),pos(16,2)),Translated) , ! , 
    Translated == conjunct(none,member(none,identifier(none,parent_),identifier(none,'Dir_')),greater(none,card(none,identifier(none,parent_)),integer(none,0))).

test(field_lone_of,[]) :- 
    alloy2b:translate_field_aux(field('parent_',loneof(identifier('Dir_',type(['Dir_'],1),pos(5,5)),type(['Dir_'],1),pos(24,2)),type(['Dir_'],1),pos(16,2)),Translated) , ! , 
    Translated == conjunct(none,member(none,identifier(none,parent_),identifier(none,'Dir_')),less_equal(none,card(none,identifier(none,parent_)),integer(none,1))).

% and
test(expr_and,[]) :- 
    alloy2b:translate_e_p(and([all(['d_', 'o_'],[field('d_',oneof(identifier('Dir_',type(['Dir_'],1),pos(5,5)),type(['Dir_'],1),pos(15,11)),type(['Dir_'],1),pos(12,11)), field('o_',oneof(join(identifier('d_',type(['Dir_'],1),pos(12,11)),identifier('contents_',type(['Dir->this_''FSObject_'],2),pos(28,5)),type(['FSObject_'],1),pos(24,11)),type(['FSObject_'],1),pos(23,11)),type(['FSObject_'],1),pos(20,11))],equal(join(identifier('o_',type(['FSObject_'],1),pos(20,11)),identifier('parent_',type(['FSObject->this_''Dir_'],2),pos(16,2)),type(['Dir_'],1),pos(37,11)),identifier('d_',type(['Dir_'],1),pos(12,11)),type(untyped),pos(45,11)),type(untyped),pos(8,11)), equal(plus(identifier('File_',type(['File_'],1),pos(5,8)),identifier('Dir_',type(['Dir_'],1),pos(5,5)),type(['File_','Dir_'],1),pos(13,14)),identifier('FSObject_',type(['FSObject_'],1),pos(5,2)),type(untyped),pos(19,14)), in(identifier('FSObject_',type(['FSObject_'],1),pos(5,2)),join(identifier('Root_',type(['Root_'],1),pos(9,17)),closure(identifier('contents_',type(['Dir->this_''FSObject_'],2),pos(28,5)),type(['univ->univ_'],2),pos(25,20)),type(['univ_'],1),pos(24,20)),type(untyped),pos(17,20)), not(no(['d_'],[field('d_',oneof(identifier('Dir_',type(['Dir_'],1),pos(5,5)),type(['Dir_'],1),pos(24,23)),type(['Dir_'],1),pos(21,23))],in(identifier('d_',type(['Dir_'],1),pos(21,23)),join(identifier('d_',type(['Dir_'],1),pos(21,23)),closure1(identifier('contents_',type(['Dir->this_''FSObject_'],2),pos(28,5)),type(['Dir->this_''FSObject_'],2),pos(37,23)),type(['FSObject_'],1),pos(36,23)),type(untyped),pos(32,23)),type(untyped),pos(18,23)),type(untyped),pos(1,23))],pos(1,11)),Translated) , ! , 
    Translated == conjunct(none,not(none,not(exists(none,[identifier(none,d_)],conjunct(none,conjunct(none,member(none,identifier(none,d_),identifier(none,'Dir_')),equal(none,card(none,identifier(none,d_)),integer(none,1))),subset(none,identifier(none,d_),image(none,closure1(none,identifier(none,contents_)),identifier(none,d_))))))),conjunct(none,subset(none,identifier(none,'FSObject_'),image(none,closure(none,identifier(none,contents_)),identifier(none,'Root_'))),conjunct(none,equal(none,union(none,identifier(none,'File_'),identifier(none,'Dir_')),identifier(none,'FSObject_')),forall(none,[identifier(none,d_),identifier(none,o_)],implication(none,conjunct(none,conjunct(none,member(none,identifier(none,o_),image(none,identifier(none,contents_),identifier(none,d_))),equal(none,card(none,identifier(none,o_)),integer(none,1))),conjunct(none,member(none,identifier(none,d_),identifier(none,'Dir_')),equal(none,card(none,identifier(none,d_)),integer(none,1)))),equal(none,image(none,identifier(none,parent_),identifier(none,o_)),identifier(none,d_))))))).

:- end_tests(single_expr_translation).
